name: NU notice Scraper

on:
  schedule:
    # বাংলাদেশ সময় দুপুর ১টায় রান হবে (7:00 AM UTC)
    - cron: '0 7 * * *'
    # বাংলাদেশ সময় রাত ৯টায় রান হবে (3:00 PM UTC)
    - cron: '0 15 * * *'
  workflow_dispatch: # ম্যানুয়ালি রান করার জন্য

permissions:
  contents: write # রিপোজিটরিতে কোড push করার জন্য পারমিশন

jobs:
  # কাজের নাম পরিবর্তন করা হয়েছে
  scrape-nu-notice:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # সম্পূর্ণ git history আনা হয়েছে যাতে pull/push ঠিকভাবে কাজ করে
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright requests Pillow
          playwright install --with-deps chromium

      - name: Run NU Notice Scraper
        # আপনার স্ক্রিপ্টের আসল নাম এখানে ব্যবহার করুন
        run: python test_code.py
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}

      - name: Commit and push if there are changes
        run: |
          # Git ইউজার কনফিগার করা
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # শুধুমাত্র যদি কোনো ফাইল পরিবর্তন হয়, তাহলেই পরবর্তী ধাপগুলো 실행 হবে
          if ! (git diff --quiet && git diff --staged --quiet); then
            echo "Changes detected. Committing and pushing..."
            
            # Push করার আগে রিমোট থেকে পরিবর্তন pull করা (rebase সহ)
            git pull --rebase
            
            # পরিবর্তনগুলো যোগ করে কমিট করা
            git add -A
            # কমিট মেসেজ পরিবর্তন করা হয়েছে
            git commit -m "CI: Update NU notice scraped data"
            
            # সবশেষে push করা
            git push
          else
            echo "No changes to commit."
          fi
